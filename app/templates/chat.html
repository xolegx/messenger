<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ß–∞—Ç</title>
    <link rel="icon" href="/static/img/favicon.ico" type="image/x-icon">

<style>
:root {
    --primary-blue: #2b5278;
    --secondary-blue: #17212b;
    --text-color: #ffffff;
    --hover-color: #182533;
    --online-color: #4CAF50;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: Arial, sans-serif;
}

body {
    background-color: var(--secondary-blue);
    color: var(--text-color);
    height: 100vh;
    display: flex;
}

.sidebar {
    width: 300px;
    background-color: var(--secondary-blue);
    border-right: 1px solid #3c3c3c;
    display: flex;
    flex-direction: column;
}

.settings {
    padding: 15px;
    background-color: var(--primary-blue);
    height: 60px;
}

.settings-btn {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 24px;
}

.set-btn {
    align-items: center;
    font-size: 20px;
    height: 50px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.2);
}

.settings-menu {
    position: fixed;
    top: 60px;
    left: -280px;
    background-color: var(--secondary-blue);
    border-radius: 5px;
    width: 280px;
    z-index: 1000;
}

.settings-menu.active {
    display: block;
    left: 0;
    transition: left 0.5s ease; 
}

.settings-menu button {
    display: block;
    width: 100%;
    padding: 10px 15px;
    background: none;
    border: none;
    color: var(--text-color);
    text-align: left;
    cursor: pointer;

}

.settings-menu button:hover {
    background-color: var(--hover-color);
}

.friends-list {
    flex-grow: 1;
    overflow-y: auto;
    font-size: 20px;
}

.friend {
    padding: 10px 15px;
    display: flex;
    align-items: center;
    cursor: pointer;
    position: relative;
}

.friend:hover {
    background-color: var(--hover-color);
}

.friend img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 10px;
}

.chat-area {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}

.chat-header {
    padding: 15px;
    background-color: var(--primary-blue);
    height: 60px;
}

.messages {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    border-right: 1px solid #3c3c3c;
    max-width: 100vh;
    background-image: url('/static/img/chatwall.png');
    background-size: cover; 
    background-position: center;
    background-repeat: no-repeat;
}

.message {
    margin-bottom: 10px;
    padding: 10px;
    border-radius: 20px;

}

.message.sent {
    background-color: #dcf8c6;
    align-self: flex-end;
    margin-left: auto;
}

.message.received {
    background-color: #f2f2f2;
}

.my-message {
    background-color: rgba(232,255,237,0.5); /* –ó–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –≤–∞—à–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
    text-align: right; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
    margin-left: 20%;
}

.other-message {
    background-color: rgba(255,255,255,0.2); /* –°–µ—Ä—ã–π —Ñ–æ–Ω –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π */
    text-align: left; /* –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
    margin-right: 20%;
}

.message-input {
    padding: 15px;
    background-color: var(--secondary-blue);
    display: flex;
    align-items: center;
    border-right: 1px solid #3c3c3c;
    width: 100vh;
}

.message-input input {
    flex-grow: 1;
    padding: 10px;
    border: none;
    font-size: 16px;
    border-radius: 20px;
    background-color: lightgrey;
}

.emoji-btn, .file-btn{
    background: none;
    border: none;
    color: var(--text-color);
    cursor: pointer;
    font-size: 20px;
    padding: 5px;
}

#emojiPicker {
    display: none;
    width: 280px;
    height: 150px;
    resize: none;
    overflow-y: auto;
    position: fixed;
    bottom: 60px; /* –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–Ω–µ–ª–∏ –≤—ã—à–µ –∫–Ω–æ–ø–∫–∏ */
    background-color: grey;
    padding: 10px;
    z-index: 1000;
    margin-left: 60vh;
}

#emojiPicker .emoji {
    cursor: pointer;
    font-size: 18px;
    margin: 1px;
}

.send-btn  {
    background-color: var(--primary-blue);
    border: none;
    color: var(--text-color);
    padding: 10px 20px;
    border-radius: 20px;
    cursor: pointer;
    transition: background-color 0.2s;
}

.send-btn:hover {
    background-color: #366290;
}

.mail {
    position: absolute;
    right: 0;
    transform: translateX(-30%);
}

.file-input {
    display: none;
}

.file-preview {
    max-width: 200px;
    margin: 10px 0;
    padding: 10px;
    background-color: var(--hover-color);
    border-radius: 4px;
    word-break: break-all;
}

.online-status {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background-color: var(--online-color);
    margin-left: 10px;
}

</style>

<div class="sidebar">
    <div class="settings">
        <button class="settings-btn">‚ò∞</button>
        <div class="settings-menu">
            <button class="set-btn" data-url="/auth/profile">üí∑ –ü—Ä–æ—Ñ–∏–ª—å</button>
            <button class="set-btn" data-url="/auth/friends">üë´ –î—Ä—É–∑—å—è</button>
            <button class="set-btn" data-url="/auth/groups">üë®‚Äçüë®‚Äçüë¶ –ì—Ä—É–ø–ø—ã</button>
            <button class="set-btn" data-url="/auth/files">üíæ –§–∞–π–ª—ã</button>
            <button class="set-btn"style="background: rgba(100,0,0,0.2)">üö™ –í—ã–π—Ç–∏</button>
                    </div>
    </div>
    <div class="friends-list" id="friends-list">
        <!-- –î—Ä—É–∑—å—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
</div>

<div class="chat-area">
    <div class="chat-header" id="chat-header">
        <h3>–í—ã–±–µ—Ä–∏—Ç–µ —á–∞—Ç</h3>
    </div>
    <div class="messages" id="messages">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>
    <div class="message-input">
            <input type="text" id="messageInput" maxlength="300" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." disabled>
            <button class="file-btn" style="margin-left: 5px">üìé</button>
            <input type="file" class="file-input" multiple>
            <button class="emoji-btn">üòä</button>
            <button class="send-btn" id="send-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <div class="emoji-picker" id="emojiPicker">
            <!-- –≠–º–æ–¥–∑–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
    </div>
</div>

<script>
const currentUserId = parseInt("{{ user.id }}", 10);
let selectedUserId = null;
let socket = null;
let previousMessages = 0;
let messagePollingInterval = null;
let status = null;
const fileBtn = document.querySelector('.file-btn');
const fileInput = document.querySelector('.file-input');
const settingsBtn = document.querySelector('.settings-btn');
const settingsMenu = document.querySelector('.settings-menu');
settingsBtn.addEventListener('click', () => {
    settingsMenu.classList.toggle('active');
});
document.addEventListener('click', (e) => {
    if (!settingsBtn.contains(e.target) && !settingsMenu.contains(e.target)) {
        settingsMenu.classList.remove('active');
    }
});

// –§—É–Ω–∫—Ü–∏—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
async function selectUser(userId, userName, event) {

    selectedUserId = userId;
    const userNametrim = userName.trim();
    const userNamesplit = userNametrim.split(' ');
    const headerName = userNamesplit.slice(1).join(' ');
    document.getElementById('chat-header').innerHTML = `<span>${headerName}</span> <br> <small style="color: #8e8e8e;">${status || "offline"}</small>` ;
    document.getElementById('messageInput').disabled = false;
    document.getElementById('send-btn').disabled = false;
    const messagesContainer = document.querySelector('.messages');
    messagesContainer.style.backgroundImage = "url('/static/img/chatwall2.png')"; 

    
    if (!event.target.classList.contains('active')){ document.querySelectorAll('.friend').forEach(item => item.classList.remove('active'));
        event.target.classList.add('active');
        messagesContainer.innerHTML = '';
        messagesContainer.style.display = 'block';
    
        await loadMessages(userId);
        connectWebSocket();
        startMessagePolling(userId);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;}}
    

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
async function loadMessages(userId) {

    try {
        const response = await fetch(`/chat/messages/${userId}`);
        const messages = await response.json();
        //console.log(messages.length, previousMessages.length);
        if (messages.length !== previousMessages.length) {
            previousMessages = messages;
            const messagesContainer = document.getElementById('messages');
        messagesContainer.innerHTML = messages.map(message =>
            createMessageElement(message.content, message.recipient_id)
        ).join('');
        }
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:', error);
    }
}

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WebSocket
function connectWebSocket() {
    if (socket) socket.close();

    socket = new WebSocket(`ws://${window.location.host}/chat/ws/${selectedUserId}`);

    socket.onopen = () => console.log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');

    socket.onmessage = (event) => {
        const incomingMessage = JSON.parse(event.data);
        if (incomingMessage.recipient_id === selectedUserId) {
            addMessage(incomingMessage.content, incomingMessage.recipient_id);
        }
    };

    socket.onclose = () => console.log('WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ');
}

// –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
async function sendMessage() {
    const messageInput = document.getElementById('messageInput');
    const message = messageInput.value.trim();

    if (message && selectedUserId) {
        const payload = {recipient_id: selectedUserId, content: message};

        try {
            await fetch('/chat/messages', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(payload)
            });

            socket.send(JSON.stringify(payload));
            addMessage(message, selectedUserId);
            messageInput.value = '';
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
        }
    }
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
function addMessage(text, recipient_id) {
    const messagesContainer = document.getElementById('messages');
    messagesContainer.insertAdjacentHTML('beforeend', createMessageElement(text, recipient_id));
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

// –°–æ–∑–¥–∞–Ω–∏–µ HTML —ç–ª–µ–º–µ–Ω—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
function createMessageElement(text, recipient_id) {
    const userID = parseInt(selectedUserId, 10);
    const messageClass = userID === recipient_id ? 'my-message' : 'other-message';
    return `<div class="message ${messageClass}">${text}</div>`;
}

// –ó–∞–ø—É—Å–∫ –æ–ø—Ä–æ—Å–∞ –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
function startMessagePolling(userId) {
    clearInterval(messagePollingInterval);
    messagePollingInterval = setInterval(() => loadMessages(userId), 1000);
       // console.log('ok')

}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
function addUserClickListeners() {
    document.querySelectorAll('.friend').forEach(item => {
        item.onclick = event => selectUser(item.getAttribute('data-user-id'), item.textContent, event);
    });
}

// –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–±—ã—Ç–∏–π –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const avatars = ['üë®', 'üë©', 'üë∂', 'üëß', 'üë¶', 'üëµ', 'üë¥', 'üßî', 'üë®‚Äçü¶≤','üë®‚Äçü¶∞', 'üë©‚Äçü¶∞', 'üë®‚Äçü¶±', 'üë©‚Äçü¶±', 'üë®‚Äçü¶≥', 'üë©‚Äçü¶≥', 'üë©‚Äçü¶≤' ];

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
async function fetchUsers() {
    try {
        const response = await fetch('/auth/users');
        const users = await response.json();
        const userList = document.getElementById('friends-list');
        userList.innerHTML = '';

        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ" –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const favoriteElement = document.createElement('div');
        favoriteElement.classList.add('friend');
        favoriteElement.setAttribute('data-user-id', currentUserId);

        // –î–æ–±–∞–≤–ª—è–µ–º "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"
        favoriteElement.innerHTML = `
            <span style="font-size: 30px;">üìù</span>
            <div>
                <div>–ú–æ–∏ –∑–∞–ø–∏—Å–∏</div>
            </div>
        `;

        userList.appendChild(favoriteElement);

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
        users.forEach(user => {
            if (user.id !== currentUserId) {
                const userElement = document.createElement('div');
                userElement.classList.add('friend');
                userElement.setAttribute('data-user-id', user.id);
                userElement.setAttribute('status', user.status);

                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —Å —É—á–µ—Ç–æ–º –∞–≤–∞—Ç–∞—Ä–∞, –∏–º–µ–Ω–∏ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
                userElement.innerHTML = `
                    <span style="font-size: 30px;">${user.avatar || "üë§"}</span>
                    <div>
                        <div>
                        ${user.name} 
                        <!--div class="online-status" style="float: right; margin-top: 5px"></div>
                        </div> 
                        <small style="color: #8e8e8e;">${user.lastMessage || "–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π"}</small-->
                    </div>
                `;
                //userElement.innerHTML += `<span class="mail">üí¨</span>`;
                userList.appendChild(userElement);
            }
        });

        // –ü–æ–≤—Ç–æ—Ä–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        addUserClickListeners();
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:', error);
    }
}

// –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞
async function logout() {
    try {
        const response = await fetch('/auth/logout', {
            method: 'POST',
            credentials: 'include'
        });

        if (response.ok) {
            window.location.href = '/auth';
        } else {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ');
        }
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞:', error);
    }
}

// –≠–º–æ–¥–∑–∏ –ø–∏–∫–µ—Ä
const emojiBtn = document.querySelector('.emoji-btn');
const emojiPicker = document.getElementById('emojiPicker');
const messageInput = document.querySelector('.message-input input');

// –°–ø–∏—Å–æ–∫ —ç–º–æ–¥–∑–∏
const emojis = [ 'üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'üòÖ', 'üòÇ', 'ü§£', 'üòä', 'üòá', 'üôÇ', 'üôÉ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòù', 'üòú', 'ü§™', 'ü§®', 'üßê', 'ü§ì', 'üòé', 'ü•≥', 'üòè', 'üòí', 'üòû', 'üòî', 'üòü', 'üòï', 'üôÅ', 'üò£', 'üòñ', 'üò´', 'üò©', 'ü•∫', 'üò¢', 'üò≠', 'üò§', 'üò†', 'üò°', 'ü§¨', 'ü§Ø', 'üò≥', 'ü•µ', 'ü•∂', 'üò±', 'üò®', 'üò∞', 'üò•', 'üòì', 'ü§ó', 'ü§î', 'ü§≠', 'ü§´', 'ü§•', 'üò∂', 'üòê', 'üòë', 'üò¨', 'üôÑ', 'üòØ', 'üò¶', 'üòß', 'üòÆ', 'üò≤', 'ü•±', 'üò¥', 'ü§§', 'üò™', 'üòµ', 'ü§ê', 'ü•¥', 'ü§¢', 'ü§Æ', 'ü§ß', 'üò∑', 'ü§í', 'ü§ï', 'ü§ë', 'ü§†', 'üòà', 'üëø', 'üëπ', 'üë∫', 'ü§°', 'üí©', 'üëª', 'üíÄ', 'üëΩ', 'üëæ', 'ü§ñ', 'üéÉ', 'üò∫', 'üò∏', 'üòπ', 'üòª', 'üòº', 'üòΩ', 'üôÄ', 'üòø', 'üòæ', 'üí™','ü¶µ','ü¶∂','üëÇ','üëÉ','ü§è','üëà','üëâ','‚òù','üëÜ','üëá','‚úå','ü§û','üññ','ü§ò','ü§ô','üñê','‚úã','üëå','üëç','üëé','‚úä','üëä','ü§õ','ü§ú','ü§ö','ü§ü','‚úç','üôè','ü§ù','üë∂', 'üßí', 'üë¶', 'üëß', 'üßë', 'üë±', 'üë®', 'üë©', 'üßî', 'üëµ', 'üë¥', 'üë≤', 'üë≥‚Äç‚ôÄ', 'üë≥‚Äç‚ôÇ', 'üßï', 'üëÆ‚Äç‚ôÄ', 'üëÆ‚Äç‚ôÇ', 'üë∑‚Äç‚ôÄ', 'üë∑‚Äç‚ôÇ', 'üíÇ‚Äç‚ôÄ', 'üíÇ‚Äç‚ôÇ', 'üïµÔ∏è‚Äç‚ôÄ', 'üïµÔ∏è‚Äç‚ôÇ', 'üë©‚Äç‚öï', 'üë®‚Äç‚öï', 'üë©‚Äçüåæ', 'üë®‚Äçüåæ', 'üë©‚Äçüç≥', 'üë®‚Äçüç≥', 'üë©‚Äçüéì', 'üë®‚Äçüéì', 'üë©‚Äçüé§', 'üë®‚Äçüé§', 'üë©‚Äçüè´', 'üë®‚Äçüè´', 'üë©‚Äçüè≠', 'üë®‚Äçüè≠', 'üë©‚Äçüíª', 'üë®‚Äçüíª', 'üë©‚Äçüíº', 'üë®‚Äçüíº', 'üë©‚Äçüîß', 'üë®‚Äçüîß', 'üë©‚Äçüî¨', 'üë®‚Äçüî¨', 'üë©‚Äçüé®', 'üë®‚Äçüé®', 'üë©‚Äçüöí', 'üë®‚Äçüöí', 'üë©‚Äç‚úà', 'üë®‚Äç‚úà', 'üë©‚ÄçüöÄ', 'üë®‚ÄçüöÄ', 'üë©‚Äç‚öñ', 'üë®‚Äç‚öñ', 'ü§∂', 'üéÖ', 'üßô‚Äç‚ôÄ', 'üßô‚Äç‚ôÇ', 'üßù‚Äç‚ôÄ', 'üßù‚Äç‚ôÇ', 'üßõ‚Äç‚ôÄ', 'üßõ‚Äç‚ôÇ', 'üßü‚Äç‚ôÄ', 'üßü‚Äç‚ôÇ', 'üßû‚Äç‚ôÄ', 'üßû‚Äç‚ôÇ', 'üßú‚Äç‚ôÄ', 'üßú‚Äç‚ôÇ', 'üßö‚Äç‚ôÄ', 'üßö‚Äç‚ôÇ', 'üëº', 'ü§∞', 'ü§±', 'üôá‚Äç‚ôÄ', 'üôá‚Äç‚ôÇ', 'üíÅ‚Äç‚ôÄ', 'üíÅ‚Äç‚ôÇ', 'üôÖ‚Äç‚ôÄ', 'üôÖ‚Äç‚ôÇ', 'üôÜ‚Äç‚ôÄ', 'üôÜ‚Äç‚ôÇ', 'üôã‚Äç‚ôÄ', 'üôã‚Äç‚ôÇ', 'üßè‚Äç‚ôÄ', 'üßè‚Äç‚ôÇ', 'ü§¶‚Äç‚ôÄ', 'ü§¶‚Äç‚ôÇ', 'ü§∑‚Äç‚ôÄ', 'ü§∑‚Äç‚ôÇ', 'üôé‚Äç‚ôÄ', 'üôé‚Äç‚ôÇ', 'üôç‚Äç‚ôÄ', 'üôç‚Äç‚ôÇ', 'üíá‚Äç‚ôÄ', 'üíá‚Äç‚ôÇ', 'üíÜ‚Äç‚ôÄ', 'üíÜ‚Äç‚ôÇ', 'üßñ‚Äç‚ôÄ', 'üßñ‚Äç‚ôÇ', 'üíÖ', 'ü§≥', 'üíÉ', 'üï∫', 'üëØ‚Äç‚ôÄ', 'üëØ‚Äç‚ôÇ', 'üï¥Ô∏è', 'üë©‚Äçü¶Ω', 'üë®‚Äçü¶Ω', 'üë©‚Äçü¶º', 'üë®‚Äçü¶º', 'üßó‚Äç‚ôÄ', 'üßó‚Äç‚ôÇ', 'ü§∫', 'üèá','üíæ','üìñ','üö™'];

// –î–æ–±–∞–≤–ª—è–µ–º —ç–º–æ–¥–∑–∏ –≤ –ø–∏–∫–µ—Ä
emojis.forEach(emoji => {
    const span = document.createElement('span');
    span.textContent = emoji;
    span.className = 'emoji';
    span.addEventListener('click', () => {
        messageInput.value += emoji;
    });
    emojiPicker.appendChild(span);
});




// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–ª–∏–∫–∞ –ø–æ –∫–Ω–æ–ø–∫–µ
emojiBtn.addEventListener('click', () => {
    emojiPicker.style.display = emojiPicker.style.display === 'block' ? 'none' : 'block';
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è –∏ —Å–Ω—è—Ç–∏—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è
emojiBtn.addEventListener('mouseenter', () => {
    emojiPicker.style.display = 'block';
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è —Å–Ω—è—Ç–∏—è –Ω–∞–≤–µ–¥–µ–Ω–∏—è —Å –ø–∞–Ω–µ–ª–∏
emojiBtn.addEventListener('mouseleave', () => {
    setTimeout(() => {
        if (!emojiPicker.matches(':hover')) {
            emojiPicker.style.display = 'none';}
},100);
});
emojiPicker.addEventListener('mouseleave', () => {emojiPicker.style.display = 'none';});

// –ó–∞–∫—Ä—ã—Ç–∏–µ —ç–º–æ–¥–∑–∏ –ø–∏–∫–µ—Ä–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
document.addEventListener('click', (e) => {
    if (!emojiBtn.contains(e.target) && !emojiPicker.contains(e.target)) {
        emojiPicker.classList.remove('active');
    }
});


document.addEventListener('DOMContentLoaded', fetchUsers);
//setInterval(fetchUsers, 10000); // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∏ –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
document.getElementById('send-btn').onclick = sendMessage;

document.getElementById('messageInput').onkeypress = async (e) => {
    if (e.key === 'Enter') {
        await sendMessage();
    }
};

fileBtn.addEventListener('click', () => {
    fileInput.click();
});

fileInput.addEventListener('change', (e) => {
    const files = Array.from(e.target.files);
    files.forEach(file => {
        const messageElement = document.createElement('div');
        messageElement.className = 'message my-message';
        messageElement.innerHTML = `
            <div class="file-preview">
                üìé ${file.name} (${(file.size / 1024).toFixed(2)} KB)
            </div>
        `;
        document.querySelector('.messages').appendChild(messageElement);
    });
    fileInput.value = '';
});


const buttons = document.querySelectorAll('.set-btn');

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è 'click' –¥–ª—è –∫–∞–∂–¥–æ–π –∫–Ω–æ–ø–∫–∏
buttons.forEach(button => {
    button.addEventListener('click', async () => {
        const url = button.getAttribute('data-url'); // –ü–æ–ª—É—á–∞–µ–º URL –∏–∑ –∞—Ç—Ä–∏–±—É—Ç–∞ data-url
        if (button.textContent === 'üö™ –í—ã–π—Ç–∏') {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤—ã–π—Ç–∏?')) {
                try {
                    // –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ logout –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—ã—Ö–æ–¥–∞
                    await logout();
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –≤—ã—Ö–æ–¥–∞:', error);
                }
                alert('–í—ã –≤—ã—à–ª–∏');
                
            }
        }else{
            window.location.href = url;
        } 
         // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
    });
});

</script>
</html>